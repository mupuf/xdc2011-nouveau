\documentclass[11pt,english,compress]{beamer}
\usepackage[utf8]{inputenc}
\usepackage{verbatim}
\usepackage{eurosym}
\usepackage{ stmaryrd }
\usepackage{listings}

\useoutertheme{smoothbars}
\useinnertheme[shadow=true]{rounded}
\usecolortheme{orchid}
\usecolortheme{whale}
\title{Nouveau}
\subtitle{Recap, on-going and future work}
\author{Karol Herbst, Pierre Moreau \& Martin Peres}
\institute{Nouveau developers}

\AtBeginSection[]{
  \begin{frame}{Summary}
  \small \tableofcontents[currentsection, hideothersubsections]
  \end{frame} 
}

\lstdefinestyle{customspirv}{
	basicstyle=\tiny,
}

\begin{document}

\setbeamertemplate{navigation symbols}{}

\begin{frame}
	\titlepage
\end{frame}

\section{Introduction}
\subsection*{Introduction}
\begin{frame}
	\frametitle{Introduction}

	\begin{block}{Introduction}
		\begin{itemize}
			\item Nouveau is Linux's OSS driver for NVIDIA GPUs;
			\item We want to provide a good out-of-the-box desktop experience;
			\item We wish to run games and compute workloads too!
		\end{itemize}
	\end{block}

	\pause

	\begin{block}{Support}
		\begin{itemize}
			\item All NVIDIA desktop GPUs since 1998 (partial support);
			\item 2D and 3D acceleration on all recent GPUs (2003+);
			\item OpenGL 4.5 (non official) \& Direct X 9 (through Wine);
			\item Video decoding on GPUs between 2004 and 2013.
		\end{itemize}
	\end{block}
\end{frame}

\section{Pascal support}
\subsection*{Pascal support}
\begin{frame}
	\frametitle{Pascal support}

	\begin{block}{Pascal GPUs}
		\begin{itemize}
			\item Current generation of desktop GPUs, released in March 2016;
			\item Most locked down NVIDIA GPUs to date;
			\pause
			\item Supported features:
			\begin{itemize}
				\item Modesetting: Complete support (Linux 4.14);
				\item 2D/3D acceleration: Yes, but firmwares came after 1+ year;
				\item Temperature reading: Yes;
				\pause
				\item Fan management: Impossible (locked down);
				\item Reclocking: Impossible (locked down);
				\item Video BIOS uploading: Impossible (locked down);
				\item Power reading: Impossible (locked down).
			\end{itemize}
		\end{itemize}
	\end{block}
\end{frame}

% Martin
\section{Power management}
\subsection*{Power Management}

\begin{frame}
	\frametitle{Power Management}

	\begin{block}{Clock gating (Lyude Paul)}
		\begin{itemize}
			\item Increases the battery life of laptops without performance loss;
			\item Experimental version for Kepler about to land in Nouveau.
		\end{itemize}
	\end{block}

	\begin{block}{Fan management (Martin Peres)}
		\begin{itemize}
			\item Adjusts the fan speed based on the temperature;
			\item Full support for most GPUs since Linux 3.13;
			\item Some GPUs require a weird calibration: Loud fans!
			\item NVIDIA is about to release some documentation for this.
		\end{itemize}
	\end{block}
\end{frame}

\begin{frame}
	\frametitle{Power Management}

	\begin{block}{Reclocking (Karol Herbst, Ben Skeggs \& Roy Spliet)}
		\begin{itemize}
			\item Support: Tesla \& Kepler is mostly good, Fermi is coming
			\item Thermal throttling: Adjust perf. to limit the temperature;
			\item On demand reclocking: Adjust the perf. based on the load;
		\end{itemize}
	\end{block}

	\begin{block}{Power monitoring (Karol Herbst)}
		\begin{itemize}
			\item Power consumption exposed when available;
			\item Able to get the power budget on a few cards
		\end{itemize}
	\end{block}
\end{frame}

\section{Userspace}
\subsection{Graphics}

\begin{frame}
	\frametitle{Graphics}

	\begin{block}{History: GL version support (NVC0: Fermi+)}
		\begin{itemize}
			\item OpenGL 4.1 support in Mesa 11.0
			\item OpenGL 4.3 support in Mesa 12.0
			\item OpenGL 4.5 support in Mesa 13.0 (unofficial, 4.3 by default)
		\end{itemize}
	\end{block}
	
	\pause
	
	\begin{block}{Vulkan}
		\begin{itemize}
			\item NIR to NVIR started for Vulkan SPIR-V support
			\item Also helps for OpenGL 4.6 (ARB\_gl\_spirv and ARB\_spirv\_extensions)
			\item Hopefully some basic Vulkan driver ready this year
		\end{itemize}
	\end{block}
\end{frame}

\subsection{OpenCL}
% Small intro/history of OpenCL ~30sec
% SPIR-V: quick summary, why interesting? ~1min
% modifications to clover, for SPIR-V, affects everyone 2min
% X how to try it ~30sec
% X quick overview on current SPIR-V -> NVIR work ~1-2min
% X how to try it? ~30sec
% Total: ~6-7min

\begin{frame}{Quick overview of SPIR-V}
	\begin{columns}
		\begin{column}{\textwidth}
			\begin{block}{SPIR-V usage}
				Used as intermediate language for
				\begin{itemize}
					\item OpenCL (via extension for 1.2 and 2.0, core
						$\geq$ 2.1);
					\item OpenGL (core 4.6, or via an extension before);
					\item Vulkan.
				\end{itemize}
			\end{block}
		\end{column}
	\end{columns}
\end{frame}

% \begin{frame}{Adding SPIR-V support to clover}
% 	\begin{block}{New entrypoints}
% 		Create programs directly from SPIR-V binaries using
% 		clCreateProgramWithILKHR() or clCreateProgramWithIL().
% 	\end{block}
% 	\begin{block}{Internal changes}
% 		\begin{itemize}
% 			\item Compilation and linking is now done in SPIR-V;
% 			\item “OpenCL executable” sent to driver using one of
% 				its supported IR; SPIR-V is converted to that
% 				IR;
% 			\item New dependencies added to Mesa (if OpenCL is
% 				enabled):
% 				\begin{itemize}
% 					\item SPIRV-Tools: for validating and
% 						linking together SPIR-V
% 						binaries;
% 					\item llvm-spirv: for converting
% 						between LLVM IR and SPIR-V.
% 				\end{itemize}
% 		\end{itemize}
% 	\end{block}
% \end{frame}

\begin{frame}{OpenCL: Try out the SPIR-V support on radeon}
	\begin{block}{Prerequisites}
		\begin{itemize}
			\item SPIRV-Tools:
				\url{https://github.com/KhronosGroup/SPIRV-Tools}
			\item llvm-spirv:
				\url{https://gitlab.collabora.com/tomeu/llvm-spirv}
			\item LLVM $\geq 5.0$
			\item Mesa: \url{https://github.com/pierremoreau/mesa}
				(branch: clover\_spirv\_series\_v3)
		\end{itemize}
	\end{block}
	\begin{block}{How to use/test it?}
		\begin{itemize}
			\item Set CLOVER\_USE\_SPIRV=1;
			\item Use clCreateProgramWithILKHR(), clCreateProgramWithIL();
			\item Or for AMD owners, use clCreateProgramWithSource().
		\end{itemize}
	\end{block}
\end{frame}

\begin{frame}{Overview of SPIR-V to NVIR}
	\begin{block}{Status for OpenCL 1.2 support for Nouveau}
		\begin{itemize}
			\item Supported:
			\begin{itemize}
				\item Most arithmetic/relational/bit/etc. operations;
				\item Most atomics and convert operations;
				\item Function calling and control flow.
			\end{itemize}
			\item Work in progress:
			\begin{itemize}
				\item Image support;
				\item Finishing off the various memory operations.
			\end{itemize}
			\item Still missing:
			\begin{itemize}
				\item Group operations;
				\item Most OpenCL specific operations.
			\end{itemize}
		\end{itemize}

		OpenCL CTS 1.2 passing rates for test\_basic: 36/95 (27 of the
		failing ones are image tests)
	\end{block}
\end{frame}

\begin{frame}{Try out OpenCL on Nouveau}
	\begin{block}{Prerequisites}
		\begin{itemize}
			\item Same as for testing the SPIR-V support;
			\item except for Mesa, for which the branch is
				nouveau\_spirv\_support.
		\end{itemize}
	\end{block}
	\begin{block}{Hardware status}
		\begin{itemize}
			\item Tesla: needs changes to the memory management
				code;
			\item Fermi: should work;
			\item Kepler: should work;
			\item Maxwell: partially works;
			\item Pascal: partially works;
		\end{itemize}
	\end{block}
\end{frame}

\section{Community}

\subsection{Current members}
\begin{frame}
	\frametitle{Community - members}

	\begin{block}{Red Hat developers working on Nouveau}
		\begin{itemize}
			\item Ben Skeggs: maintainer and long time contributor;
			\item Lyude Paul: part time on power management;
			\item Karol Herbst: full time on reclocking, mesa and Compute.
		\end{itemize}
	\end{block}

	\pause

	% TODO
	\begin{block}{Community}
		\begin{itemize}
			\item Rhys Kidd: Tooling (IGT, shader-db), Thermal management;
			\item Ilia Mirkin: Mesa developer, OpenGL;
			\item Pierre Moreau: SPIR-V, OpenCL, compiler opts;
			\item Martin Peres: Fan management, power management;
			\item Roy Spliet: DVFS (reclocking), compiler opts;
			\item You? Join us!
		\end{itemize}
	\end{block}
\end{frame}

\subsection{History with NVIDIA}
\begin{frame}
	\frametitle{Community - Relationship with NVIDIA}

	\begin{block}{Recent History with NVIDIA}
		\begin{itemize}
			\item Sept 2013: First real contact
			\begin{itemize}
				\item NVIDIA released public vbios documentation (DCB);
				\item Offered us a contact email to answer questions;
				\item Are willing to improve the out-of-the-box
experience of users;
			\end{itemize}
			\item 2015-2017: NVIDIA hired someone to work on Nouveau
			\begin{itemize}
				\item Added Tegra K1/X1/X2 support to Nouveau;
				\item Led to a Nouveau-based product (Pixel-C);
				\item Wrote secure-boot support for Maxwell+;
			\end{itemize}
			\item 2018: New documentation dump for the vbios tables.
		\end{itemize}
	\end{block}
\end{frame}

\begin{frame}
	\frametitle{Community - What we need from NVIDIA}

	\begin{block}{Locked GPUs affect development and user experience}
		\begin{itemize}
			\item 2015: The Maxwell 2+ GPU are locked, signed FWs prevent:
			\begin{itemize}
				\item Accelerated graphics: usually given a year after release;
				\item Fan management: no FW provided;
				\item Reclocking: no FW provided;
				\item Power reading: no FW provided;
				\item VBIOS reverse engineering: prevented by software.
			\end{itemize}
			\item 2018: Some VBIOS documentation landed:
			\begin{itemize}
				\item A website appeared to sign some vbios;
				\item Some signs of opening?
			\end{itemize}
		\end{itemize}
	\end{block}
\end{frame}

\section{Conclusion}

\subsection*{Conclusion}
\begin{frame}
	\frametitle{Conclusion}

	\begin{block}{Nouveau is improving}
		\begin{itemize}
			\item Nouveau is still the default driver in all distributions;
			\item The GL driver is in good shape: OpenGL 4.4 and 4.5 coming;
			\item Performance needs to improve for 4K displays: reclocking!;
			\item Power efficiency for laptop users need to be improved too.
		\end{itemize}
	\end{block}

	\begin{block}{Join the fun?}
		\begin{itemize}
			\item Why not join the team? We have lots of challenges!
			\item GSoC/EVoC students: we'll have projects for you!
		\end{itemize}
	\end{block}
\end{frame}


\end{document}
